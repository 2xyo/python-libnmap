<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>libnmap.diff &mdash; libnmap 0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="libnmap 0.2 documentation" href="index.html" />
    <link rel="prev" title="libnmap.objects" href="objects.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="objects.html" title="libnmap.objects"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">libnmap 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="libnmap-diff">
<h1>libnmap.diff<a class="headerlink" href="#libnmap-diff" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what">
<h2>What<a class="headerlink" href="#what" title="Permalink to this headline">¶</a></h2>
<p>This modules enables the user to diff two NmapObjects: NmapService, NmapHost, NmapReport.</p>
<p>The constructor returns a NmapDiff object which he can then use to call its inherited methods:</p>
<blockquote>
<div><ul class="simple">
<li>added()</li>
<li>removed()</li>
<li>changed()</li>
<li>unchanged()</li>
</ul>
</div></blockquote>
<p>Those methods return a python set() of keys which have been changed/added/removed/unchanged from one
object to another.
The keys of each objects could be found in the implementation of the get_dict() methods of the compared objects.</p>
<p>The example below is a heavy version of going through all nested objects to see waht has changed after a diff:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">libnmap.parser</span> <span class="kn">import</span> <span class="n">NmapParser</span>

<span class="n">rep1</span> <span class="o">=</span> <span class="n">NmapParser</span><span class="o">.</span><span class="n">parse_fromfile</span><span class="p">(</span><span class="s">&#39;libnmap/test/files/1_hosts.xml&#39;</span><span class="p">)</span>
<span class="n">rep2</span> <span class="o">=</span> <span class="n">NmapParser</span><span class="o">.</span><span class="n">parse_fromfile</span><span class="p">(</span><span class="s">&#39;libnmap/test/files/1_hosts_diff.xml&#39;</span><span class="p">)</span>

<span class="n">rep1_items_changed</span> <span class="o">=</span> <span class="n">rep1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rep2</span><span class="p">)</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>
<span class="n">changed_host_id</span> <span class="o">=</span> <span class="n">rep1_items_changed</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">changed_host1</span> <span class="o">=</span> <span class="n">rep1</span><span class="o">.</span><span class="n">get_host_byid</span><span class="p">(</span><span class="n">changed_host_id</span><span class="p">)</span>
<span class="n">changed_host2</span> <span class="o">=</span> <span class="n">rep2</span><span class="o">.</span><span class="n">get_host_byid</span><span class="p">(</span><span class="n">changed_host_id</span><span class="p">)</span>
<span class="n">host1_items_changed</span> <span class="o">=</span> <span class="n">changed_host1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">changed_host2</span><span class="p">)</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>

<span class="n">changed_service_id</span> <span class="o">=</span> <span class="n">host1_items_changed</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">changed_service1</span> <span class="o">=</span> <span class="n">changed_host1</span><span class="o">.</span><span class="n">get_service_byid</span><span class="p">(</span><span class="n">changed_service_id</span><span class="p">)</span>
<span class="n">changed_service2</span> <span class="o">=</span> <span class="n">changed_host2</span><span class="o">.</span><span class="n">get_service_byid</span><span class="p">(</span><span class="n">changed_service_id</span><span class="p">)</span>
<span class="n">service1_items_changed</span> <span class="o">=</span> <span class="n">changed_service1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">changed_service2</span><span class="p">)</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>

<span class="k">for</span> <span class="n">diff_attr</span> <span class="ow">in</span> <span class="n">service1_items_changed</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;diff({0}, {1}) [{2}:{3}] [{4}:{5}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">changed_service1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                     <span class="n">changed_service2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                     <span class="n">diff_attr</span><span class="p">,</span>
                                                     <span class="nb">getattr</span><span class="p">(</span><span class="n">changed_service1</span><span class="p">,</span> <span class="n">diff_attr</span><span class="p">),</span>
                                                     <span class="n">diff_attr</span><span class="p">,</span>
                                                     <span class="nb">getattr</span><span class="p">(</span><span class="n">changed_service2</span><span class="p">,</span> <span class="n">diff_attr</span><span class="p">))</span>
</pre></div>
</div>
<p>This outputs the following line:</p>
<div class="highlight-python"><pre>(pydev)$ python /tmp/z.py
diff(tcp.3306, tcp.3306) [state:open] [state:filtered]
(pydev)$</pre>
</div>
<p>Of course, the above code is quite ugly and heavy but the idea behind diff was to be as generic as possible in order to
let the user of the lib defines its own algorithms to extract the data.</p>
<p>A less manual and more clever approach would be to recursively retrieve the changed attributes and values of nested objects.
Below, you will find a small code example only covering changed attributes. To implement a full diff, just duplicate that code
for added and removed keys:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">libnmap.parser</span> <span class="kn">import</span> <span class="n">NmapParser</span>


<span class="k">def</span> <span class="nf">nested_obj</span><span class="p">(</span><span class="n">objname</span><span class="p">):</span>
    <span class="n">rval</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">splitted</span> <span class="o">=</span> <span class="n">objname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;::&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitted</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">splitted</span>
    <span class="k">return</span> <span class="n">rval</span>


<span class="k">def</span> <span class="nf">print_diff</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
    <span class="n">ndiff</span> <span class="o">=</span> <span class="n">obj1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>

    <span class="n">changed_keys</span> <span class="o">=</span> <span class="n">ndiff</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ckey</span> <span class="ow">in</span> <span class="n">changed_keys</span><span class="p">:</span>
        <span class="n">nested</span> <span class="o">=</span> <span class="n">nested_obj</span><span class="p">(</span><span class="n">ckey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nested</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nested</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;NmapHost&#39;</span><span class="p">:</span>
                <span class="n">subobj1</span> <span class="o">=</span> <span class="n">obj1</span><span class="o">.</span><span class="n">get_host_byid</span><span class="p">(</span><span class="n">nested</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">subobj2</span> <span class="o">=</span> <span class="n">obj2</span><span class="o">.</span><span class="n">get_host_byid</span><span class="p">(</span><span class="n">nested</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">nested</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;NmapService&#39;</span><span class="p">:</span>
                <span class="n">subobj1</span> <span class="o">=</span> <span class="n">obj1</span><span class="o">.</span><span class="n">get_service_byid</span><span class="p">(</span><span class="n">nested</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">subobj2</span> <span class="o">=</span> <span class="n">obj2</span><span class="o">.</span><span class="n">get_service_byid</span><span class="p">(</span><span class="n">nested</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">print_diff</span><span class="p">(</span><span class="n">subobj1</span><span class="p">,</span> <span class="n">subobj2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;~ {0} {1}: {2} =&gt; {3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">ckey</span><span class="p">,</span>
                                             <span class="nb">getattr</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">ckey</span><span class="p">),</span>
                                             <span class="nb">getattr</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="n">ckey</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rep1</span> <span class="o">=</span> <span class="n">NmapParser</span><span class="o">.</span><span class="n">parse_fromfile</span><span class="p">(</span><span class="s">&#39;libnmap/test/files/1_hosts.xml&#39;</span><span class="p">)</span>
    <span class="n">rep2</span> <span class="o">=</span> <span class="n">NmapParser</span><span class="o">.</span><span class="n">parse_fromfile</span><span class="p">(</span><span class="s">&#39;libnmap/test/files/1_hosts_diff.xml&#39;</span><span class="p">)</span>

    <span class="n">print_diff</span><span class="p">(</span><span class="n">rep1</span><span class="p">,</span> <span class="n">rep2</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="module-libnmap.diff">
<span id="code-api"></span><h2>Code API<a class="headerlink" href="#module-libnmap.diff" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="libnmap.diff.NmapDiff">
<em class="property">class </em><tt class="descclassname">libnmap.diff.</tt><tt class="descname">NmapDiff</tt><big>(</big><em>nmap_obj1</em>, <em>nmap_obj2</em><big>)</big><a class="reference internal" href="_modules/libnmap/diff.html#NmapDiff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#libnmap.diff.NmapDiff" title="Permalink to this definition">¶</a></dt>
<dd><p>NmapDiff compares two objects of same type to enable the user to check:</p>
<ul class="simple">
<li>what has changed</li>
<li>what has been added</li>
<li>what has been removed</li>
<li>what was kept unchanged</li>
</ul>
<p>NmapDiff inherit from DictDiffer which makes the actual comparaison.
The different methods from DictDiffer used by NmapDiff are the
following:</p>
<ul class="simple">
<li>NmapDiff.changed()</li>
<li>NmapDiff.added()</li>
<li>NmapDiff.removed()</li>
<li>NmapDiff.unchanged()</li>
</ul>
<p>Each of the returns a python set() of key which have changed in the
compared objects. To check the different keys that could be returned,
refer to the get_dict() method of the objects you which to
compare (i.e: libnmap.objects.NmapHost, NmapService,...).</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">libnmap.diff</a><ul>
<li><a class="reference internal" href="#what">What</a></li>
<li><a class="reference internal" href="#module-libnmap.diff">Code API</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="objects.html"
                        title="previous chapter">libnmap.objects</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/diff.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="objects.html" title="libnmap.objects"
             >previous</a> |</li>
        <li><a href="index.html">libnmap 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright CC-BY 2013, Ronald Bister.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>