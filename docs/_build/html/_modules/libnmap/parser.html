<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>libnmap.parser &mdash; libnmap 0.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="libnmap 0.2 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">libnmap 0.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for libnmap.parser</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">libnmap.objects</span> <span class="kn">import</span> <span class="n">NmapHost</span><span class="p">,</span> <span class="n">NmapService</span><span class="p">,</span> <span class="n">NmapReport</span>


<div class="viewcode-block" id="NmapParser"><a class="viewcode-back" href="../../parser.html#libnmap.parser.NmapParser">[docs]</a><span class="k">class</span> <span class="nc">NmapParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NmapParser.parse"><a class="viewcode-back" href="../../parser.html#libnmap.parser.NmapParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">nmap_data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s">&#39;XML&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Generic class method of NmapParser class.</span>
<span class="sd">            The data to be parsed does not need to be a complete nmap</span>
<span class="sd">            scan report. You can possibly give &lt;hosts&gt;...&lt;/hosts&gt;</span>
<span class="sd">            or &lt;port&gt; XML tags.</span>

<span class="sd">            :param nmap_data: any portion of nmap scan result.</span>

<span class="sd">            nmap_data should always be a string representing a part</span>
<span class="sd">            or a complete nmap scan report.</span>

<span class="sd">            :type nmap_data: string</span>

<span class="sd">            :param data_type: specifies the type of data to be parsed.</span>
<span class="sd">            :type data_type: string (&quot;XML&quot;|&quot;JSON&quot;|&quot;YAML&quot;).</span>

<span class="sd">            As of today, only XML parsing is supported.</span>

<span class="sd">            :return: NmapObject (NmapHost, NmapService or NmapReport)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nmapobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s">&quot;XML&quot;</span><span class="p">:</span>
            <span class="n">nmapobj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml</span><span class="p">(</span><span class="n">nmap_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Unknown data type provided. &quot;</span>
                                      <span class="s">&quot;Please check documentation for &quot;</span>
                                      <span class="s">&quot;supported data types.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nmapobj</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_xml</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">nmap_data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Protected class method used to process a specific data type.</span>
<span class="sd">            In this case: XML. This method is called by cls.parse class</span>
<span class="sd">            method and receives nmap scan results data (in XML).</span>

<span class="sd">            :param nmap_data: any portion of nmap scan result can be given</span>
<span class="sd">            as argument. nmap_data should always be a string representing</span>
<span class="sd">            a part or a complete nmap scan report.</span>
<span class="sd">            :type nmap_data: string</span>

<span class="sd">            This method checks which portion of a nmap scan is given</span>
<span class="sd">            as argument.</span>
<span class="sd">            It could be:</span>

<span class="sd">                1. a full nmap scan report;</span>
<span class="sd">                2. a scanned host: &lt;host&gt; tag in a nmap scan report</span>
<span class="sd">                3. a scanned service: &lt;port&gt; tag</span>
<span class="sd">                4. a list of hosts: &lt;hosts/&gt; tag (TODO)</span>
<span class="sd">                5. a list of ports: &lt;ports/&gt; tag</span>

<span class="sd">            :return: NmapObject (NmapHost, NmapService or NmapReport)</span>
<span class="sd">                    or a list of NmapObject</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">nmap_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;No report data to parse: please &quot;</span>
                                      <span class="s">&quot;provide a valid XML nmap report&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmap_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;wrong nmap_data type given as &quot;</span>
                                      <span class="s">&quot;argument: cannot parse data&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">nmap_data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Wrong XML structure: cannot parse data&quot;</span><span class="p">)</span>

        <span class="n">nmapobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;nmaprun&#39;</span><span class="p">:</span>
            <span class="n">nmapobj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_report</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;host&#39;</span><span class="p">:</span>
            <span class="n">nmapobj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_host</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;ports&#39;</span><span class="p">:</span>
            <span class="n">nmapobj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_ports</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;port&#39;</span><span class="p">:</span>
            <span class="n">nmapobj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_port</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Unpexpected data structure for XML &quot;</span>
                                      <span class="s">&quot;root node&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nmapobj</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_xml_report</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This method parses out a full nmap scan report from its XML root</span>
<span class="sd">            node: &lt;nmaprun&gt;.</span>

<span class="sd">            :param root: Element from xml.ElementTree (top of XML the document)</span>
<span class="sd">            :type root: Element</span>

<span class="sd">            :return: NmapReport object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nmap_scan</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;_nmaprun&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s">&#39;_scaninfo&#39;</span><span class="p">:</span> <span class="p">{},</span>
                     <span class="s">&#39;_hosts&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;_runstats&#39;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;No root node provided to parse XML &quot;</span>
                                      <span class="s">&quot;report&quot;</span><span class="p">)</span>

        <span class="n">nmap_scan</span><span class="p">[</span><span class="s">&#39;_nmaprun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;scaninfo&#39;</span><span class="p">:</span>
                <span class="n">nmap_scan</span><span class="p">[</span><span class="s">&#39;_scaninfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__parse_scaninfo</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;host&#39;</span><span class="p">:</span>
                <span class="n">nmap_scan</span><span class="p">[</span><span class="s">&#39;_hosts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_host</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;runstats&#39;</span><span class="p">:</span>
                <span class="n">nmap_scan</span><span class="p">[</span><span class="s">&#39;_runstats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__parse_runstats</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="c">#else:</span>
            <span class="c">#    print &quot;struct pparse unknown attr: {0} value: {1}&quot;.format(</span>
            <span class="c">#        el.tag,</span>
            <span class="c">#        el.get(el.tag))</span>
        <span class="k">return</span> <span class="n">NmapReport</span><span class="p">(</span><span class="n">nmap_scan</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NmapParser.parse_fromstring"><a class="viewcode-back" href="../../parser.html#libnmap.parser.NmapParser.parse_fromstring">[docs]</a>    <span class="k">def</span> <span class="nf">parse_fromstring</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">nmap_data</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s">&quot;XML&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Call generic cls.parse() method and ensure that a string is</span>
<span class="sd">            passed on as argument. If not, an exception is raised.</span>

<span class="sd">            :param nmap_data: Same as for parse(), any portion of nmap scan.</span>

<span class="sd">            Reports could be passed as argument. Data type _must_ be a string.</span>

<span class="sd">            :type nmap_data: string</span>

<span class="sd">            :param data_type: Specifies the type of data passed on as argument.</span>

<span class="sd">            :return: NmapObject</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmap_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;bad argument type for &quot;</span>
                                      <span class="s">&quot;xarse_fromstring(): should be a string&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">nmap_data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NmapParser.parse_fromfile"><a class="viewcode-back" href="../../parser.html#libnmap.parser.NmapParser.parse_fromfile">[docs]</a>    <span class="k">def</span> <span class="nf">parse_fromfile</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">nmap_report_path</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s">&quot;XML&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Call generic cls.parse() method and ensure that a correct file</span>
<span class="sd">            path is given as argument. If not, an exception is raised.</span>

<span class="sd">            :param nmap_data: Same as for parse().</span>

<span class="sd">            Any portion of nmap scan reports could be passed as argument.</span>

<span class="sd">            Data type _must be a valid path to a file containing</span>
<span class="sd">            nmap scan results.</span>

<span class="sd">            :param data_type: Specifies the type of serialization in the file.</span>

<span class="sd">            :return: NmapObject</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nmap_report_path</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileobj</span><span class="p">:</span>
                <span class="n">fdata</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">rval</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fdata</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">rval</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NmapParser.parse_fromdict"><a class="viewcode-back" href="../../parser.html#libnmap.parser.NmapParser.parse_fromdict">[docs]</a>    <span class="k">def</span> <span class="nf">parse_fromdict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">rdict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Strange method which transforms a python dict</span>
<span class="sd">            representation of a NmapReport and turns it into an</span>
<span class="sd">            NmapReport object.</span>
<span class="sd">            Needs to be reviewed and possibly removed.</span>

<span class="sd">            :param rdict: python dict representation of an NmapReport</span>
<span class="sd">            :type rdict: dict</span>

<span class="sd">            :return: NmapReport</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nreport</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">rdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;__NmapReport__&#39;</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">rdict</span><span class="p">[</span><span class="s">&#39;__NmapReport__&#39;</span><span class="p">]</span>
            <span class="n">nreport</span><span class="p">[</span><span class="s">&#39;_runstats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s">&#39;_runstats&#39;</span><span class="p">]</span>
            <span class="n">nreport</span><span class="p">[</span><span class="s">&#39;_scaninfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s">&#39;_scaninfo&#39;</span><span class="p">]</span>
            <span class="n">nreport</span><span class="p">[</span><span class="s">&#39;_nmaprun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s">&#39;_nmaprun&#39;</span><span class="p">]</span>
            <span class="n">hlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s">&#39;_hosts&#39;</span><span class="p">]:</span>
                <span class="n">slist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">h</span><span class="p">[</span><span class="s">&#39;__NmapHost__&#39;</span><span class="p">][</span><span class="s">&#39;_services&#39;</span><span class="p">]:</span>
                    <span class="n">cname</span> <span class="o">=</span> <span class="s">&#39;__NmapService__&#39;</span>
                    <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NmapService</span><span class="p">(</span><span class="n">portid</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="s">&#39;_portid&#39;</span><span class="p">],</span>
                                             <span class="n">protocol</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="s">&#39;_protocol&#39;</span><span class="p">],</span>
                                             <span class="n">state</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="s">&#39;_state&#39;</span><span class="p">],</span>
                                             <span class="n">service</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="s">&#39;_service&#39;</span><span class="p">]))</span>

                <span class="n">nh</span> <span class="o">=</span> <span class="n">NmapHost</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="s">&#39;__NmapHost__&#39;</span><span class="p">][</span><span class="s">&#39;_starttime&#39;</span><span class="p">],</span>
                              <span class="n">endtime</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="s">&#39;__NmapHost__&#39;</span><span class="p">][</span><span class="s">&#39;_endtime&#39;</span><span class="p">],</span>
                              <span class="n">address</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="s">&#39;__NmapHost__&#39;</span><span class="p">][</span><span class="s">&#39;_address&#39;</span><span class="p">],</span>
                              <span class="n">status</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="s">&#39;__NmapHost__&#39;</span><span class="p">][</span><span class="s">&#39;_status&#39;</span><span class="p">],</span>
                              <span class="n">hostnames</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="s">&#39;__NmapHost__&#39;</span><span class="p">][</span><span class="s">&#39;_hostnames&#39;</span><span class="p">],</span>
                              <span class="n">services</span><span class="o">=</span><span class="n">slist</span><span class="p">)</span>
                <span class="n">hlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
            <span class="n">nreport</span><span class="p">[</span><span class="s">&#39;_hosts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hlist</span>
            <span class="n">nmapobj</span> <span class="o">=</span> <span class="n">NmapReport</span><span class="p">(</span><span class="n">nreport</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nmapobj</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__parse_scaninfo</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scaninfo_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Private method parsing a portion of a nmap scan result.</span>
<span class="sd">            Receives a &lt;scaninfo&gt; XML tag.</span>

<span class="sd">            :param scaninfo_data: &lt;scaninfo&gt; XML tag from a nmap scan</span>
<span class="sd">            :type scaninfo_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: python dict representing the XML scaninfo tag</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">scaninfo_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xelement</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_xml_host</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scanhost_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Protected method parsing a portion of a nmap scan result.</span>
<span class="sd">            Receives a &lt;host&gt; XML tag representing a scanned host with</span>
<span class="sd">            its services.</span>

<span class="sd">            :param scaninfo_data: &lt;host&gt; XML tag from a nmap scan</span>
<span class="sd">            :type scaninfo_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: NmapHost object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">scanhost_data</span><span class="p">)</span>

        <span class="n">_host_header</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xelement</span><span class="p">)</span>
        <span class="n">_hostnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_services</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_status</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_address</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_host_extras</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">extra_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;uptime&#39;</span><span class="p">,</span> <span class="s">&#39;distance&#39;</span><span class="p">,</span> <span class="s">&#39;tcpsequence&#39;</span><span class="p">,</span>
                      <span class="s">&#39;ipidsequence&#39;</span><span class="p">,</span> <span class="s">&#39;tcptssequence&#39;</span><span class="p">,</span> <span class="s">&#39;times&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">xh</span> <span class="ow">in</span> <span class="n">xelement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xh</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;hostnames&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">hostname</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__parse_hostnames</span><span class="p">(</span><span class="n">xh</span><span class="p">):</span>
                    <span class="n">_hostnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xh</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;ports&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_ports</span><span class="p">(</span><span class="n">xh</span><span class="p">):</span>
                    <span class="n">_services</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xh</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;status&#39;</span><span class="p">:</span>
                <span class="n">_status</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xh</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;address&#39;</span><span class="p">:</span>
                <span class="n">_address</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xh</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;os&#39;</span><span class="p">:</span>
                <span class="n">_os_extra</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__parse_os_fingerprint</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
                <span class="n">_host_extras</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;os&#39;</span><span class="p">:</span> <span class="n">_os_extra</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">xh</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">extra_tags</span><span class="p">:</span>
                <span class="n">_host_extras</span><span class="p">[</span><span class="n">xh</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
            <span class="c">#else:</span>
            <span class="c">#    print &quot;struct host unknown attr: %s value: %s&quot; %</span>
            <span class="c">#           (h.tag, h.get(h.tag))</span>
        <span class="n">nhost</span> <span class="o">=</span> <span class="n">NmapHost</span><span class="p">(</span><span class="n">_host_header</span><span class="p">[</span><span class="s">&#39;starttime&#39;</span><span class="p">],</span>
                         <span class="n">_host_header</span><span class="p">[</span><span class="s">&#39;endtime&#39;</span><span class="p">],</span>
                         <span class="n">_address</span><span class="p">,</span>
                         <span class="n">_status</span><span class="p">,</span>
                         <span class="n">_hostnames</span><span class="p">,</span>
                         <span class="n">_services</span><span class="p">,</span>
                         <span class="n">_host_extras</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nhost</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__parse_hostnames</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scanhostnames_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Private method parsing the hostnames list within a &lt;host&gt; XML tag.</span>

<span class="sd">            :param scanhostnames_data: &lt;hostnames&gt; XML tag from a nmap scan</span>
<span class="sd">            :type scanhostnames_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: list of hostnames</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">scanhostnames_data</span><span class="p">)</span>
        <span class="n">hostnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">hname</span> <span class="ow">in</span> <span class="n">xelement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hname</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;hostname&#39;</span><span class="p">:</span>
                <span class="n">hostnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hname</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">hostnames</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_xml_ports</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scanports_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Protected method parsing the list of scanned services from</span>
<span class="sd">            a targeted host. This protected method cannot be called directly</span>
<span class="sd">            with a string. A &lt;ports/&gt; tag can be directly passed to parse()</span>
<span class="sd">            and the below method will be called and return a list of nmap</span>
<span class="sd">            scanned services.</span>

<span class="sd">            :param scanports_data: &lt;ports&gt; XML tag from a nmap scan</span>
<span class="sd">            :type scanports_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: list of NmapService</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">scanports_data</span><span class="p">)</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xservice</span> <span class="ow">in</span> <span class="n">xelement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xservice</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;port&#39;</span><span class="p">:</span>
                <span class="n">nport</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_parse_xml_port</span><span class="p">(</span><span class="n">xservice</span><span class="p">)</span>
                <span class="n">ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nport</span><span class="p">)</span>
            <span class="c">#else:</span>
            <span class="c">#    print &quot;struct port unknown attr: %s value: %s&quot; %</span>
            <span class="c">#           (h.tag, h.get(h.tag))</span>
        <span class="k">return</span> <span class="n">ports</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_parse_xml_port</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scanport_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Protected method parsing a scanned service from a targeted host.</span>
<span class="sd">            This protected method cannot be called directly.</span>
<span class="sd">            A &lt;port/&gt; tag can be directly passed to parse() and the below</span>
<span class="sd">            method will be called and return a NmapService object</span>
<span class="sd">            representing the state of the service.</span>

<span class="sd">            :param scanport_data: &lt;port&gt; XML tag from a nmap scan</span>
<span class="sd">            :type scanport_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: NmapService</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">scanport_data</span><span class="p">)</span>

        <span class="n">_port</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xelement</span><span class="p">)</span>
        <span class="n">_portid</span> <span class="o">=</span> <span class="n">_port</span><span class="p">[</span><span class="s">&#39;portid&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;portid&#39;</span> <span class="ow">in</span> <span class="n">_port</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">_protocol</span> <span class="o">=</span> <span class="n">_port</span><span class="p">[</span><span class="s">&#39;protocol&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;protocol&#39;</span> <span class="ow">in</span> <span class="n">_port</span> <span class="k">else</span> <span class="bp">None</span>

        <span class="n">_state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">_service</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">_service_extras</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xport</span> <span class="ow">in</span> <span class="n">xelement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xport</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;state&#39;</span><span class="p">:</span>
                <span class="n">_state</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xport</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xport</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;service&#39;</span><span class="p">:</span>
                <span class="n">_service</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xport</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xport</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;script&#39;</span><span class="p">:</span>
                <span class="n">_script_dict</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xport</span><span class="p">)</span>
                <span class="n">_service_extras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_script_dict</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">_portid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">_protocol</span> <span class="ow">is</span> <span class="bp">None</span>
                <span class="ow">or</span> <span class="n">_state</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">_service</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;XML &lt;port&gt; tag is incomplete. One &quot;</span>
                                      <span class="s">&quot;of the following tags is missing: &quot;</span>
                                      <span class="s">&quot;portid, protocol state or service.&quot;</span><span class="p">)</span>

        <span class="n">nport</span> <span class="o">=</span> <span class="n">NmapService</span><span class="p">(</span><span class="n">_portid</span><span class="p">,</span>
                            <span class="n">_protocol</span><span class="p">,</span>
                            <span class="n">_state</span><span class="p">,</span>
                            <span class="n">_service</span><span class="p">,</span>
                            <span class="n">_service_extras</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nport</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__parse_os_fingerprint</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">os_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Private method parsing the data from an OS fingerprint (-O).</span>
<span class="sd">            Contents of &lt;os&gt; is returned as a dict.</span>

<span class="sd">            :param os_data: portion of XML describing the results of the</span>
<span class="sd">            os fingerprinting attempt</span>
<span class="sd">            :type os_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: python dict representing the XML os tag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">os_data</span><span class="p">)</span>

        <span class="n">os_class_probability</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">os_match_probability</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">os_ports_used</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">os_fp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">xos</span> <span class="ow">in</span> <span class="n">xelement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xos</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;osclass&#39;</span><span class="p">:</span>
                <span class="n">os_class_proba</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xos</span><span class="p">)</span>
                <span class="n">os_class_probability</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os_class_proba</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xos</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;osmatch&#39;</span><span class="p">:</span>
                <span class="n">os_match_proba</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xos</span><span class="p">)</span>
                <span class="n">os_match_probability</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os_match_proba</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xos</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;portused&#39;</span><span class="p">:</span>
                <span class="n">os_portused</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xos</span><span class="p">)</span>
                <span class="n">os_ports_used</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os_portused</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">xos</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;osfingerprint&#39;</span><span class="p">:</span>
                <span class="n">os_fp</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xos</span><span class="p">)</span>

        <span class="n">rdict</span><span class="p">[</span><span class="s">&#39;osmatch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os_match_probability</span>
        <span class="n">rdict</span><span class="p">[</span><span class="s">&#39;osclass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os_class_probability</span>
        <span class="n">rdict</span><span class="p">[</span><span class="s">&#39;ports_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os_ports_used</span>
        <span class="n">rdict</span><span class="p">[</span><span class="s">&#39;osfingerprint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os_fp</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">rdict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__parse_runstats</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scanrunstats_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Private method parsing a portion of a nmap scan result.</span>
<span class="sd">            Receives a &lt;runstats&gt; XML tag.</span>

<span class="sd">            :param scanrunstats_data: &lt;runstats&gt; XML tag from a nmap scan</span>
<span class="sd">            :type scanrunstats_data: xml.ElementTree.Element or a string</span>

<span class="sd">            :return: python dict representing the XML runstats tag</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xelement</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_element</span><span class="p">(</span><span class="n">scanrunstats_data</span><span class="p">)</span>

        <span class="n">rdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">xmltag</span> <span class="ow">in</span> <span class="n">xelement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xmltag</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;finished&#39;</span><span class="p">,</span> <span class="s">&#39;hosts&#39;</span><span class="p">]:</span>
                <span class="n">rdict</span><span class="p">[</span><span class="n">xmltag</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__format_attributes</span><span class="p">(</span><span class="n">xmltag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Unpexpected data structure &quot;</span>
                                          <span class="s">&quot;for &lt;runstats&gt;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rdict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__format_element</span><span class="p">(</span><span class="n">elt_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Private method which ensures that a XML portion to be parsed is</span>
<span class="sd">            of type xml.etree.ElementTree.Element.</span>
<span class="sd">            If elt_data is a string, then it is converted to an</span>
<span class="sd">            XML Element type.</span>

<span class="sd">            :param elt_data: XML Element to be parsed or string</span>
<span class="sd">            to be converted to a XML Element</span>

<span class="sd">            :return: Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xelement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">elt_data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Error while trying &quot;</span>
                                          <span class="s">&quot;to instanciate XML Element from &quot;</span>
                                          <span class="s">&quot;string {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elt_data</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ET</span><span class="o">.</span><span class="n">iselement</span><span class="p">(</span><span class="n">elt_data</span><span class="p">):</span>
            <span class="n">xelement</span> <span class="o">=</span> <span class="n">elt_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Error while trying to parse supplied &quot;</span>
                                      <span class="s">&quot;data: unsupported format&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xelement</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__format_attributes</span><span class="p">(</span><span class="n">elt_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Private method which converts a single XML tag to a python dict.</span>
<span class="sd">            It also checks that the elt_data given as argument is of type</span>
<span class="sd">            xml.etree.ElementTree.Element</span>

<span class="sd">            :param elt_data: XML Element to be parsed or string</span>
<span class="sd">            to be converted to a XML Element</span>

<span class="sd">            :return: Element</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rval</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ET</span><span class="o">.</span><span class="n">iselement</span><span class="p">(</span><span class="n">elt_data</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Error while trying to parse supplied &quot;</span>
                                      <span class="s">&quot;data attributes: format is not XML or &quot;</span>
                                      <span class="s">&quot;XML tag is empty&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dkey</span> <span class="ow">in</span> <span class="n">elt_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rval</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">elt_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dkey</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rval</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NmapParserException</span><span class="p">(</span><span class="s">&quot;Error while trying to build-up &quot;</span>
                                              <span class="s">&quot;element attributes: empty &quot;</span>
                                              <span class="s">&quot;attribute {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dkey</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">rval</span>

</div>
<span class="k">class</span> <span class="nc">NmapParserException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">libnmap 0.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright CC-BY 2013, Ronald Bister.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>